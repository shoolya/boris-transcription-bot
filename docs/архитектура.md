# Архитектура проекта BORIS

## Общая схема

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Frontend      │    │     Nginx       │    │    Backend      │
│   (React PWA)   │◄──►│   (Proxy)       │◄──►│   (Node.js)     │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                │                       │
                                ▼                       ▼
                       ┌─────────────────┐    ┌─────────────────┐
                       │   PostgreSQL    │    │      Redis      │
                       │   (Database)    │    │    (Queue)      │
                       └─────────────────┘    └─────────────────┘
                                │                       │
                                ▼                       ▼
                       ┌─────────────────┐    ┌─────────────────┐
                       │ Yandex Object   │    │  Yandex Cloud   │
                       │   Storage       │    │   SpeechKit     │
                       └─────────────────┘    └─────────────────┘
```

## Компоненты и их взаимодействие

### 1. Frontend (React PWA)
**Расположение**: `frontend/`  
**Роль**: Пользовательский интерфейс  
**Взаимодействие**:
- Отправляет API запросы к Backend
- Получает WebSocket уведомления о статусе транскрибации
- Загружает аудиофайлы через Backend

**Ключевые файлы**:
- `frontend/src/` - исходный код React приложения
- `frontend/package.json` - зависимости и скрипты
- `frontend/Dockerfile` - контейнеризация

### 2. Backend (Node.js API)
**Расположение**: `backend/`  
**Роль**: API сервер, бизнес-логика  
**Взаимодействие**:
- Обрабатывает запросы от Frontend
- Взаимодействует с PostgreSQL для данных
- Использует Redis для очередей задач
- Интегрируется с Yandex SpeechKit
- Сохраняет файлы в Yandex Object Storage

**Ключевые файлы**:
- `backend/src/` - исходный код API
- `backend/package.json` - зависимости
- `backend/Dockerfile` - контейнеризация

### 3. Database (PostgreSQL)
**Расположение**: Docker контейнер  
**Роль**: Хранение данных  
**Взаимодействие**:
- Backend читает/записывает данные пользователей
- Хранит информацию об аудиофайлах
- Сохраняет результаты транскрибации
- Ведет историю экспорта

**Схема данных**:
- `users` - пользователи системы
- `audio_files` - загруженные аудиофайлы
- `transcriptions` - результаты транскрибации
- `summaries` - сформированные тезисы
- `export_history` - история экспорта

### 4. Queue (Redis + Bull)
**Расположение**: Docker контейнер  
**Роль**: Асинхронная обработка задач  
**Взаимодействие**:
- Backend добавляет задачи транскрибации
- Worker процессы обрабатывают задачи
- Уведомляет о завершении через WebSocket

**Типы задач**:
- Транскрибация аудиофайлов
- Формирование тезисов
- Экспорт документов

### 5. Storage (Yandex Object Storage)
**Расположение**: Облачное хранилище  
**Роль**: Хранение аудиофайлов  
**Взаимодействие**:
- Backend загружает аудиофайлы
- SpeechKit получает файлы для обработки
- Результаты сохраняются для скачивания

### 6. SpeechKit (Yandex Cloud)
**Расположение**: Облачный API  
**Роль**: Распознавание речи  
**Взаимодействие**:
- Backend отправляет аудиофайлы
- Возвращает текст транскрибации
- Определяет спикеров

### 7. Proxy (Nginx)
**Расположение**: `docker/nginx/`  
**Роль**: Маршрутизация и балансировка  
**Взаимодействие**:
- Проксирует запросы к Frontend
- Маршрутизирует API запросы к Backend
- Обрабатывает WebSocket соединения
- Сжимает статические файлы

**Конфигурация**: `docker/nginx/nginx.conf`

## Поток данных

### Загрузка и транскрибация аудио
1. **Frontend** → **Backend**: Загрузка аудиофайла
2. **Backend** → **Storage**: Сохранение файла
3. **Backend** → **Database**: Запись информации о файле
4. **Backend** → **Queue**: Добавление задачи транскрибации
5. **Queue** → **SpeechKit**: Отправка файла на обработку
6. **SpeechKit** → **Backend**: Результат транскрибации
7. **Backend** → **Database**: Сохранение результата
8. **Backend** → **Frontend**: WebSocket уведомление о завершении

### Формирование тезисов
1. **Frontend** → **Backend**: Запрос на формирование тезисов
2. **Backend** → **Queue**: Добавление задачи анализа
3. **Queue** → **AI Service**: Обработка текста
4. **AI Service** → **Backend**: Структурированные тезисы
5. **Backend** → **Database**: Сохранение тезисов
6. **Backend** → **Frontend**: Результат

## Зависимости между компонентами

### Критические зависимости
- **Frontend** зависит от **Backend** API
- **Backend** зависит от **Database** и **Queue**
- **Queue** зависит от **Redis**
- **Backend** зависит от **SpeechKit** и **Storage**

### Порядок запуска
1. **PostgreSQL** и **Redis** (базовые сервисы)
2. **Backend** (API сервер)
3. **Frontend** (веб-приложение)
4. **Nginx** (прокси)

## Масштабирование

### Горизонтальное масштабирование
- **Backend**: Множество экземпляров за Nginx
- **Queue**: Множество worker процессов
- **Database**: Репликация для чтения

### Вертикальное масштабирование
- Увеличение ресурсов контейнеров
- Оптимизация запросов к базе данных
- Кэширование часто используемых данных

## Безопасность

### Аутентификация
- JWT токены для API
- Сессии для WebSocket соединений

### Авторизация
- Проверка прав доступа к файлам
- Валидация входных данных

### Защита данных
- HTTPS для всех соединений
- Шифрование чувствительных данных
- Ограничение размера загружаемых файлов
